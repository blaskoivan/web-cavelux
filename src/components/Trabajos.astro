---
const cards = [
  {
    imgSrc: "fotos_trabajos/ploteo_vehicular1.jpg",
    name: "Ploteo vehicular",
    description:
      "El ploteo vehicular convierte tu vehículo en una herramienta de comunicación en movimiento. Con materiales de alta calidad y diseños personalizados, logramos que tu marca se vea en cada recorrido, garantizando durabilidad, resistencia a la intemperie y un acabado profesional",
    whatsappLink:
      "https://wa.me/12345678901?text=Hola,%20quiero%20una%20cotización%20de%20Ploteo%20vehicular",
    gallery: [
      "fotos_trabajos/ploteo_vehicular1.jpg",
      "fotos_trabajos/ploteo_vehicular2.jpg",
      "fotos_trabajos/ploteo_vehicular3.jpg",
      "fotos_trabajos/ploteo_vehicular4.jpg"
    ]
  },
  {
    imgSrc: "fotos_trabajos/carteleria1.jpg",
    name: "Carteleria",
    description:"Frontlight: Los carteles frontlight se iluminan desde el frente mediante reflectores externos. Son una opción resistente y versátil, ideal para destacar tu marca en espacios amplios y con excelente visibilidad nocturna. Backlight: Los carteles backlight cuentan con iluminación LED interna que atraviesa la lona generando un brillo uniforme y atractivo. Son perfectos para lograr un impacto visual moderno y llamativo, tanto de día como de noche",
    whatsappLink:
      "https://wa.me/10987654321?text=Hola,%20quiero%20una%20cotización%20de%20Carteleria",
    gallery: [
      "fotos_trabajos/carteleria1.jpg",
      "fotos_trabajos/carteleria2.jpg",
      "fotos_trabajos/carteleria3.jpg",
      "fotos_trabajos/carteleria4.jpg"
    ]
  },
  {
    imgSrc: "fotos_trabajos/letras_cajas.jpg",
    name: "Letras corporeas",
    description:
      "Las letras corpóreas son una de las formas más elegantes y efectivas de dar identidad a tu marca. Con múltiples materiales y terminaciones, se adaptan tanto a interiores como a exteriores, ofreciendo presencia, durabilidad y un acabado de calidad",
    whatsappLink:
      "https://wa.me/11223344556?text=Hola,%20quiero%20una%20cotización%20de%20Letras%20cajas",
    gallery: [
      "fotos_trabajos/letras_cajas.jpg",
      "fotos_trabajos/letras_cajas2.jpg",
      "fotos_trabajos/letras_cajas3.jpg",
      "fotos_trabajos/letras_cajas4.jpg"
    ]
  },
  {
    imgSrc: "fotos_trabajos/letras_cajas.jpg",
    name: "Impresiones",
    description:
      "Impresiones de gran formato con la mejor calidad y definición. Ofrecemos soluciones personalizadas en lonas, vinilos, posters y más, garantizando colores intensos, nitidez y durabilidad en cada trabajo",
    whatsappLink:
      "https://wa.me/11223344556?text=Hola,%20quiero%20una%20cotización%20de%20Impresiones",
    gallery: [
      "fotos_trabajos/letras_cajas.jpg",
      "fotos_trabajos/impresiones2.jpg",
      "fotos_trabajos/impresiones3.jpg",
      "fotos_trabajos/impresiones4.jpg"
    ]
  },
  {
    imgSrc: "fotos_trabajos/fachada1.jpg",
    name: "Fachadas",
    description:
      "Las fachadas son la carta de presentación de tu negocio. Diseñamos y fabricamos soluciones integrales que combinan estructura, estética y durabilidad, logrando una imagen impactante que refleja la identidad de tu marca desde el primer vistazo",
    whatsappLink:
      "https://wa.me/11223344556?text=Hola,%20quiero%20una%20cotización%20de%20Fachadas",
    gallery: [
      "fotos_trabajos/fachada1.jpg",
      "fotos_trabajos/fachada2.jpg",
      "fotos_trabajos/fachada3.jpg",
      "fotos_trabajos/fachada4.jpg"
    ]
  },
  {
    imgSrc: "fotos_trabajos/señaletica1.jpg",
    name: "Señaletica",
    description:
      "Soluciones funcionales y estéticas para guiar, ordenar y comunicar en todo tipo de espacios, con diseños duraderos y de fácil lectura.",
    whatsappLink: "https://wa.me/11223344556?text=Hola,%20quiero%20una%20cotización%20de%20Señaletica",
    gallery: [
      "fotos_trabajos/señaletica1.jpg",
      "fotos_trabajos/señaletica2.jpg",
      "fotos_trabajos/señaletica3.jpg",
      "fotos_trabajos/señaletica4.jpg"
    ]
  },
  {
    imgSrc: "fotos_trabajos/flybanner1.jpg",
    name: "Flybanners",
    description:
      "Los flybanners son una opción práctica, portátil y llamativa para dar visibilidad a tu marca en eventos, ferias o puntos de venta. Resistentes al viento y de fácil armado, permiten destacar tu imagen en cualquier espacio con un diseño dinámico y atractivo.",
    whatsappLink: "https://wa.me/11223344556?text=Hola,%20quiero%20una%20cotización%20de%20Flybanners",
    gallery: [
      "fotos_trabajos/flybanner1.jpg",
      "fotos_trabajos/flybanner2.jpg",
      "fotos_trabajos/flybanner3.jpg",
      "fotos_trabajos/flybanner4.jpg"
    ]
  },
  {
    imgSrc: "fotos_trabajos/cartel_rutero1.jpg",
    name: "Carteles ruteros",
    description:
      "Presencia en rutas y accesos estratégicos con estructuras sólidas, gran formato y máxima visibilidad a la distancia.",
    whatsappLink: "https://wa.me/11223344556?text=Hola,%20quiero%20una%20cotización%20de%20Carteles%20ruteros",
    gallery: [
      "fotos_trabajos/cartel_rutero1.jpg",
      "fotos_trabajos/cartel_rutero2.jpg",
      "fotos_trabajos/cartel_rutero3.jpg",
      "fotos_trabajos/cartel_rutero4.jpg"
    ]
  },
  {
    imgSrc: "fotos_trabajos/lonas_syder1.jpg",
    name: "Lonas syder",
    description:
      "Protección y publicidad en movimiento. Lonas resistentes y personalizadas para camiones, que combinan funcionalidad y visibilidad de marca en cada recorrido.",
    whatsappLink: "https://wa.me/11223344556?text=Hola,%20quiero%20una%20cotización%20de%20Lonas%20syder",
    gallery: [
      "fotos_trabajos/lonas_syder1.jpg",
      "fotos_trabajos/lonas_syder2.jpg",
      "fotos_trabajos/lonas_syder3.jpg",
      "fotos_trabajos/lonas_syder4.jpg"
    ]
  },
];
---

<style>
  html {
    scroll-behavior: smooth;
  }

  .group:hover .hover-content,
  .group.active .hover-content {
    opacity: 1;
    transform: translateY(0);
  }

  .hover-content {
    opacity: 0;
    transform: translateY(2rem);
    transition: opacity 0.3s ease, transform 0.3s ease;
  }

  .modal-overlay {
    background-color: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(5px);
  }

  .modal-content {
    background-color: #0b3e61;
    border: 2px solid #0b3f61;
    border-radius: 20px;
  }

  /* Slider Container */
  .slider-section {
    position: relative;
    width: 100%;
    background: #0a3552;
    overflow: hidden;
  }

  .slider-wrapper {
    display: flex;
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    height: 500px;
  }

  .slider-image {
    min-width: 100%;
    height: 100%;
    object-fit: contain;
    background: #0a3552;
    padding: 2rem;
  }

  .slider-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 55px;
    height: 55px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.4);
    border-radius: 50%;
    color: white;
    font-size: 2rem;
    cursor: pointer;
    z-index: 5;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    line-height: 1;
  }

  .slider-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-50%) scale(1.1);
  }

  .slider-btn.prev {
    left: 1.5rem;
  }

  .slider-btn.next {
    right: 1.5rem;
  }

  .slider-indicators {
    position: absolute;
    bottom: 1.5rem;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 0.75rem;
    z-index: 5;
  }

  .indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.4);
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid transparent;
  }

  .indicator.active {
    background: white;
    width: 40px;
    border-radius: 6px;
  }

  .indicator:hover {
    background: rgba(255, 255, 255, 0.7);
  }

  /* Modal Info Section */
  .modal-info {
    padding: 2rem;
    background: linear-gradient(180deg, #0b3e61 0%, #0a3552 100%);
  }

  .modal-title {
    color: white;
    font-size: 2rem;
    font-weight: bold;
    margin-bottom: 1rem;
  }

  .modal-description {
    color: rgba(255, 255, 255, 0.9);
    font-size: 1rem;
    line-height: 1.8;
    margin-bottom: 2rem;
  }

  .btn-cotizacion {
    width: 100%;
    padding: 1rem;
    background: white;
    color: #0b3f61;
    text-decoration: none;
    border-radius: 12px;
    font-size: 1.1rem;
    font-weight: 700;
    text-align: center;
    display: block;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(255, 255, 255, 0.2);
    border: 2px solid white;
  }

  .btn-cotizacion:hover {
    background: transparent;
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255, 255, 255, 0.3);
  }

  .close-btn {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.4);
    color: white;
    font-size: 2rem;
    font-weight: bold;
    cursor: pointer;
    z-index: 10;
    width: 45px;
    height: 45px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    line-height: 1;
  }

  .close-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: rotate(90deg);
  }

  @media (max-width: 768px) {
    .modal-content {
      margin: 1rem;
      max-height: 90vh;
    }

    .slider-wrapper {
      height: 300px;
    }

    .slider-image {
      padding: 1rem;
    }

    .slider-btn {
      width: 45px;
      height: 45px;
      font-size: 1.5rem;
    }

    .slider-btn.prev {
      left: 0.5rem;
    }

    .slider-btn.next {
      right: 0.5rem;
    }

    .modal-info {
      padding: 1.5rem;
    }

    .modal-title {
      font-size: 1.5rem;
    }
  }
</style>

<script id="cards-data" type="application/json" set:html={JSON.stringify(cards)}></script>

<div class="max-w-[95rem] mx-auto mt-16 px-4">
  <h2 class="text-3xl font-bold text-[#0b3f61] mb-16 text-left">
    Nuestros trabajos
  </h2>

  <div
    id="trabajos"
    class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 rounded-lg overflow-hidden"
  >
    {cards.map((card, index) => (
      <div
        class="group relative block bg-black rounded-lg overflow-hidden cursor-pointer card-container"
        id={`card-${index}`}
        data-card-index={index}
      >
        <img
          alt={card.name}
          src={card.imgSrc}
          class="absolute inset-0 h-full w-full object-cover opacity-75 transition-opacity group-hover:opacity-50"
        />
        <div class="absolute inset-0 bg-[#0b3e61] opacity-0 transition-opacity group-hover:opacity-50" />

        <div class="relative p-4 sm:p-6 lg:p-8 h-full flex flex-col justify-between">
          <p class="text-xl font-bold text-white sm:text-2xl">{card.name}</p>

          <div class="mt-32 sm:mt-48 lg:mt-64 space-y-4 hover-content flex-grow">
            <p class="text-sm text-white line-clamp-4">{card.description}</p>
            <button
              class="ver-mas-btn w-full block text-center border-2 border-white text-white font-semibold py-2 px-4 rounded transition-colors hover:bg-[#0b3e61] hover:border-[#0b3e61] hover:text-white"
              data-index={index}
            >
              Ver más
            </button>
          </div>
        </div>
      </div>
    ))}
  </div>
</div>

<!-- Modal con Slider -->
<div id="modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4 modal-overlay">
  <div id="modal-content" class="relative w-full max-w-5xl max-h-[95vh] overflow-hidden modal-content">
    <button class="close-btn" id="close-modal-btn">×</button>

    <!-- Slider Section -->
    <div class="slider-section">
      <div class="slider-wrapper" id="slider-wrapper">
        <!-- Images will be inserted here -->
      </div>
      <button class="slider-btn prev" id="prev-btn">‹</button>
      <button class="slider-btn next" id="next-btn">›</button>
      <div class="slider-indicators" id="indicators">
        <!-- Indicators will be inserted here -->
      </div>
    </div>

    <!-- Info Section -->
    <div class="modal-info">
      <h3 id="modal-title" class="modal-title"></h3>
      <p id="modal-description" class="modal-description"></p>
      <a
        id="modal-whatsapp"
        target="_blank"
        rel="noopener noreferrer"
        class="btn-cotizacion"
      >
        Pedir cotización por WhatsApp
      </a>
    </div>
  </div>
</div>

<script lang="js">
  var cardsDataElement = document.getElementById('cards-data');
  var cards = JSON.parse(cardsDataElement.textContent);
  var selectedIndex = -1;
  var currentSlide = 0;
  var totalSlides = 0;

  function toggleCardActive(element) {
    var isActive = element.classList.contains('active');
    var activeElements = document.querySelectorAll('.group.active');
    for (var i = 0; i < activeElements.length; i++) {
      activeElements[i].classList.remove('active');
    }
    if (!isActive) {
      element.classList.add('active');
    }
  }

  function updateSlider() {
    var sliderWrapper = document.getElementById('slider-wrapper');
    var translateX = -(currentSlide * 100);
    sliderWrapper.style.transform = 'translateX(' + translateX + '%)';

    var indicators = document.querySelectorAll('.indicator');
    for (var i = 0; i < indicators.length; i++) {
      indicators[i].classList.remove('active');
    }
    if (indicators[currentSlide]) {
      indicators[currentSlide].classList.add('active');
    }
  }

  function nextSlide() {
    currentSlide = (currentSlide + 1) % totalSlides;
    updateSlider();
  }

  function prevSlide() {
    currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
    updateSlider();
  }

  function goToSlide(index) {
    currentSlide = index;
    updateSlider();
  }

  function openModal(index, event) {
    if (event) {
      event.stopPropagation();
    }
    selectedIndex = index;
    var card = cards[index];
    if (!card) return;

    currentSlide = 0;
    totalSlides = card.gallery.length;

    document.getElementById('modal-title').textContent = card.name;
    document.getElementById('modal-description').textContent = card.description;
    document.getElementById('modal-whatsapp').href = card.whatsappLink;

    var sliderWrapper = document.getElementById('slider-wrapper');
    var imagesHTML = '';
    for (var i = 0; i < card.gallery.length; i++) {
      var imgSrc = card.gallery[i];
      var altText = card.name + ' ' + (i + 1);
      imagesHTML += '<img src="' + imgSrc + '" alt="' + altText + '" class="slider-image">';
    }
    sliderWrapper.innerHTML = imagesHTML;

    var indicatorsContainer = document.getElementById('indicators');
    var indicatorsHTML = '';
    for (var j = 0; j < card.gallery.length; j++) {
      var activeClass = j === 0 ? ' active' : '';
      indicatorsHTML += '<div class="indicator' + activeClass + '" data-index="' + j + '"></div>';
    }
    indicatorsContainer.innerHTML = indicatorsHTML;

    var indicatorElements = document.querySelectorAll('.indicator');
    for (var k = 0; k < indicatorElements.length; k++) {
      indicatorElements[k].addEventListener('click', function() {
        var idx = parseInt(this.getAttribute('data-index'));
        goToSlide(idx);
      });
    }

    document.getElementById('modal').classList.remove('hidden');
    document.body.style.overflow = 'hidden';
  }

  function closeModal() {
    document.getElementById('modal').classList.add('hidden');
    document.body.style.overflow = 'auto';
    selectedIndex = -1;
    currentSlide = 0;
  }

  document.addEventListener('DOMContentLoaded', function() {
    var cardContainers = document.querySelectorAll('.card-container');
    for (var i = 0; i < cardContainers.length; i++) {
      cardContainers[i].addEventListener('click', function() {
        toggleCardActive(this);
      });
    }

    var verMasButtons = document.querySelectorAll('.ver-mas-btn');
    for (var j = 0; j < verMasButtons.length; j++) {
      verMasButtons[j].addEventListener('click', function(event) {
        var index = parseInt(this.getAttribute('data-index'));
        openModal(index, event);
      });
    }

    var modal = document.getElementById('modal');
    modal.addEventListener('click', function(event) {
      if (event.target === modal) {
        closeModal();
      }
    });

    document.getElementById('close-modal-btn').addEventListener('click', closeModal);
    document.getElementById('prev-btn').addEventListener('click', prevSlide);
    document.getElementById('next-btn').addEventListener('click', nextSlide);
  });

  document.addEventListener('keydown', function(e) {
    var modalElement = document.getElementById('modal');
    if (!modalElement.classList.contains('hidden')) {
      if (e.key === 'Escape') {
        closeModal();
      } else if (e.key === 'ArrowLeft') {
        prevSlide();
      } else if (e.key === 'ArrowRight') {
        nextSlide();
      }
    }
  });
</script>